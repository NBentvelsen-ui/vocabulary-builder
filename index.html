<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vocabulary Builder</title>

    <!-- React CDN -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>

    <!-- Babel -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- Tailwind -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Lucide Icons (no imports needed) -->
    <script src="https://unpkg.com/lucide@latest"></script>
</head>
<body class="bg-gradient-to-br from-blue-50 to-indigo-50">

<div id="root"></div>

<script type="text/babel">
// Icons via lucide.createIcons()
setTimeout(() => lucide.createIcons(), 0);

function VocabularyBuilder() {
  const [words, setWords] = React.useState([]);
  const [loading, setLoading] = React.useState(true);
  const [showForm, setShowForm] = React.useState(false);
  const [selectedWord, setSelectedWord] = React.useState(null);
  const [selectedCategory, setSelectedCategory] = React.useState("All");
  const [searchTerm, setSearchTerm] = React.useState("");

  const [formData, setFormData] = React.useState({
    word: "",
    meaning: "",
    sentence: "",
    synonyms: "",
    category: ""
  });

  React.useEffect(() => {
    loadWords();
  }, []);

  async function loadWords() {
    try {
      const result = await window.storage.list("word:", false);
      let loaded = [];

      if (result?.keys?.length) {
        for (let key of result.keys) {
          const data = await window.storage.get(key, false);
          if (data?.value) loaded.push(JSON.parse(data.value));
        }
      } else {
        const examples = [
          { id: Date.now(), word: "Ephemeral", meaning: "Short-lived", category: "Adjective" },
          { id: Date.now() + 1, word: "Serendipity", meaning: "Happy accident", category: "Noun" }
        ];
        for (let w of examples)
          await window.storage.set(`word:${w.id}`, JSON.stringify(w), false);
        loaded = examples;
      }

      setWords(loaded);
    } finally {
      setLoading(false);
    }
  }

  function exportToExcel() {
    const header = ["Word","Meaning","Sentence","Synonyms","Category"];
    const rows = words.map(w => [w.word, w.meaning, w.sentence || "", w.synonyms || "", w.category || ""]);

    let csv = header.join(",") + "\n";
    rows.forEach(r => (csv += r.join(",") + "\n"));

    const blob = new Blob([csv], { type: "text/csv" });
    const link = document.createElement("a");
    link.href = URL.createObjectURL(blob);
    link.download = "vocabulary_export.csv";
    link.click();
  }

  const filteredWords = words.filter(w => {
    const c = selectedCategory === "All" || w.category === selectedCategory;
    const s = w.word.toLowerCase().includes(searchTerm.toLowerCase());
    return c && s;
  });

  async function saveWord() {
    const nw = { ...formData, id: Date.now() };
    await window.storage.set(`word:${nw.id}`, JSON.stringify(nw), false);
    setWords([...words, nw]);
    setFormData({ word:"", meaning:"", sentence:"", synonyms:"", category:"" });
    setShowForm(false);
  }

  async function deleteWord(id) {
    await window.storage.delete(`word:${id}`, false);
    setWords(words.filter(w => w.id !== id));
    setSelectedWord(null);
  }

  if (loading) return <div className="min-h-screen flex items-center justify-center text-lg">Loading…</div>;

  return (
    <div className="p-6 pb-28 max-w-4xl mx-auto">

      <div className="text-center mb-8">
        <h1 className="text-4xl font-bold text-indigo-700 flex justify-center gap-2 items-center">
          <i data-lucide="book-open" class="w-10 h-10"></i> Vocabulary Builder
        </h1>

        <button onClick={exportToExcel} className="mt-4 bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700">
          Export to Excel
        </button>
      </div>

      <div className="flex justify-center mb-4">
        <input className="px-3 py-2 rounded border w-64" placeholder="Search…" value={searchTerm} onChange={e => setSearchTerm(e.target.value)} />
      </div>

      <div className="flex flex-wrap gap-3 justify-center mb-8">
        {filteredWords.map(w => (
          <button key={w.id} className="px-4 py-2 bg-white rounded-full shadow hover:scale-105 border" onClick={() => setSelectedWord(w)}>
            {w.word}
          </button>
        ))}
      </div>

      <div className="fixed bottom-0 left-0 right-0 bg-white p-4 border-t shadow-lg flex justify-center">
        <button onClick={() => setShowForm(true)} className="bg-indigo-600 text-white px-6 py-3 rounded-lg flex items-center gap-2">
          <i data-lucide="plus" class="w-5 h-5"></i> Add Word
        </button>
      </div>

      {showForm && (
        <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4" onClick={() => setShowForm(false)}>
          <div className="bg-white rounded-xl p-6 w-full max-w-lg" onClick={e => e.stopPropagation()}>
            <h2 className="text-2xl font-bold mb-4">Add Word</h2>

            {Object.keys(formData).map(key => (
              <input
                key={key}
                className="w-full mb-3 p-2 border rounded"
                placeholder={key}
                value={formData[key]}
                onChange={e => setFormData({ ...formData, [key]: e.target.value })}
              />
            ))}

            <button onClick={saveWord} className="w-full bg-indigo-600 text-white py-2 rounded-lg mt-2">Save</button>
          </div>
        </div>
      )}

      {selectedWord && (
        <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4" onClick={() => setSelectedWord(null)}>
          <div className="bg-white rounded-xl p-6 w-full max-w-lg" onClick={e => e.stopPropagation()}>
            <h2 className="text-3xl font-bold text-indigo-600 mb-2">{selectedWord.word}</h2>
            <p className="mb-4">{selectedWord.meaning}</p>
            <button onClick={() => deleteWord(selectedWord.id)} className="w-full py-2 text-red-600 border rounded-lg">Delete</button>
          </div>
        </div>
      )}
    </div>
  );
}

ReactDOM.createRoot(document.getElementById("root")).render(<VocabularyBuilder />);
</script>
</body>
</html>
